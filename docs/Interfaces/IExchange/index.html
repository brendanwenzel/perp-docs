<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Perpetual protocol" href="/lushan-docs/opensearch.xml"><title data-react-helmet="true">IExchange | Perpetual protocol</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://perpetual-protocol.github.io/lushan-docs/docs/Interfaces/IExchange"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="IExchange | Perpetual protocol"><meta data-react-helmet="true" name="description" content="SwapParams"><meta data-react-helmet="true" property="og:description" content="SwapParams"><link data-react-helmet="true" rel="shortcut icon" href="/lushan-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://perpetual-protocol.github.io/lushan-docs/docs/Interfaces/IExchange"><link data-react-helmet="true" rel="alternate" href="https://perpetual-protocol.github.io/lushan-docs/docs/Interfaces/IExchange" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://perpetual-protocol.github.io/lushan-docs/docs/Interfaces/IExchange" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://3TBGQBHK03-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/lushan-docs/assets/css/styles.d18305f4.css">
<link rel="preload" href="/lushan-docs/assets/js/runtime~main.8cd79a0c.js" as="script">
<link rel="preload" href="/lushan-docs/assets/js/main.9411a86b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lushan-docs/"><img src="/lushan-docs/img/logo.png" alt="Perpetual protocol Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/lushan-docs/img/logo.png" alt="Perpetual protocol Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Perpetual protocol</b></a><a class="navbar__item navbar__link navbar__link--active" href="/lushan-docs/docs/ContractOverview">Contract</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/perpetual-protocol/lushan-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/lushan-docs/docs/ContractOverview">Smart Contracts Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Interface</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IAccountBalance">IAccountBalance</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IBaseToken">IBaseToken</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IClearingHouse">IClearingHouse</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IClearingHouseConfig">IClearingHouseConfig</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/ICollateralManager">ICollateralManager</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IERC20Metadata">IERC20Metadata</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lushan-docs/docs/Interfaces/IExchange">IExchange</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IIndexPrice">IIndexPrice</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IInsuranceFund">IInsuranceFund</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IMarketRegistry">IMarketRegistry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IOrderBook">IOrderBook</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IVault">IVault</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Interfaces/IVirtualToken">IVirtualToken</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contracts</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Guides/data_source">Data Sources</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/lushan-docs/docs/Guides/how_to_get_trader_info">How to get  every traderâ€™s sub component by taker / maker by market</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>IExchange</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="swapparams"></a>SwapParams<a class="hash-link" href="#swapparams" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  struct SwapParams(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address trader</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool isBaseToQuote</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool isExactInput</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool isClose</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 amount</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint160 sqrtPriceLimitX96</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="swapresponse"></a>SwapResponse<a class="hash-link" href="#swapresponse" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  struct SwapResponse(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 base</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 quote</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int256 exchangedPositionSize</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int256 exchangedPositionNotional</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 fee</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 insuranceFundFee</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int256 pnlToBeRealized</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 sqrtPriceAfterX96</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int24 tick</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool isPartialClose</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="swapcallbackdata"></a>SwapCallbackData<a class="hash-link" href="#swapcallbackdata" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  struct SwapCallbackData(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address trader</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address pool</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint24 uniswapFeeRatio</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 fee</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="realizepnlparams"></a>RealizePnlParams<a class="hash-link" href="#realizepnlparams" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  struct RealizePnlParams(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address trader</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int256 base</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    int256 quote</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="functions"></a>Functions<a class="hash-link" href="#functions" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="swap"></a>swap<a class="hash-link" href="#swap" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function swap(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct IExchange.SwapParams params</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (struct IExchange.SwapResponse swapResponse)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The actual swap function</p><p>can only be called from ClearingHouse</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters"></a>Parameters:<a class="hash-link" href="#parameters" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>params</code></td><td align="left">struct IExchange.SwapParams</td><td align="left">The parameters of the swap</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values"></a>Return Values:<a class="hash-link" href="#return-values" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>swapResponse</code></td><td align="left">struct IExchange.SwapResponse</td><td align="left">The result of the swap</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="settlefunding"></a>settleFunding<a class="hash-link" href="#settlefunding" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function settleFunding(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (int256 fundingPayment, struct Funding.Growth fundingGrowthGlobal)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Settle the funding payment for the time interval since the last settlement</p><p>This function should be called at the beginning of every high-level function, such as <code>openPosition()</code>
while it doesn&#x27;t matter who calls this function
this function 1. settles personal funding payment 2. updates global funding growth
personal funding payment is settled whenever there is pending funding payment
the global funding growth update only happens once per unique timestamp (not blockNumber, due to Arbitrum)</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-1"></a>Return Values:<a class="hash-link" href="#return-values-1" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>fundingPayment</code></td><td align="left">int256</td><td align="left">the funding payment of a trader in one market should be settled into owned realized Pnl</td></tr><tr><td align="left"><code>fundingGrowthGlobal</code></td><td align="left">struct Funding.Growth</td><td align="left">the up-to-date globalFundingGrowth, usually used for later calculations</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getmaxtickcrossedwithinblock"></a>getMaxTickCrossedWithinBlock<a class="hash-link" href="#getmaxtickcrossedwithinblock" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getMaxTickCrossedWithinBlock(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (uint24 maxTickCrossedWithinBlock)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get the max ticks allowed to be crossed within a block when reducing position</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters-1"></a>Parameters:<a class="hash-link" href="#parameters-1" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>baseToken</code></td><td align="left">address</td><td align="left">Address of the base token</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-2"></a>Return Values:<a class="hash-link" href="#return-values-2" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>maxTickCrossedWithinBlock</code></td><td align="left">uint24</td><td align="left">The max ticks allowed to be crossed within a block when reducing position</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getallpendingfundingpayment"></a>getAllPendingFundingPayment<a class="hash-link" href="#getallpendingfundingpayment" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getAllPendingFundingPayment(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (int256 pendingFundingPayment)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get all the pending funding payment for a trader</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-3"></a>Return Values:<a class="hash-link" href="#return-values-3" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>pendingFundingPayment</code></td><td align="left">int256</td><td align="left">The pending funding payment of the trader.</td></tr></tbody></table><p>Positive value means the trader pays funding, negative value means the trader receives funding.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getpendingfundingpayment"></a>getPendingFundingPayment<a class="hash-link" href="#getpendingfundingpayment" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getPendingFundingPayment(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (int256 pendingFundingPayment)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get the pending funding payment for a trader in a given market</p><p>this is the view version of _updateFundingGrowth()</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-4"></a>Return Values:<a class="hash-link" href="#return-values-4" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>pendingFundingPayment</code></td><td align="left">int256</td><td align="left">The pending funding payment of a trader in one market,</td></tr></tbody></table><p>including liquidity &amp; balance coefficients. Positive value means the trader pays funding,
negative value means the trader receives funding.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getsqrtmarktwapx96"></a>getSqrtMarkTwapX96<a class="hash-link" href="#getsqrtmarktwapx96" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getSqrtMarkTwapX96(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 twapInterval</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (uint160 sqrtMarkTwapX96)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get the square root of the market twap price with the given time interval</p><p>The return value is a X96 number</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters-2"></a>Parameters:<a class="hash-link" href="#parameters-2" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>baseToken</code></td><td align="left">address</td><td align="left">Address of the base token</td></tr><tr><td align="left"><code>twapInterval</code></td><td align="left">uint32</td><td align="left">The time interval in seconds</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-5"></a>Return Values:<a class="hash-link" href="#return-values-5" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>sqrtMarkTwapX96</code></td><td align="left">uint160</td><td align="left">The square root of the market twap price</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getpnltoberealized"></a>getPnlToBeRealized<a class="hash-link" href="#getpnltoberealized" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getPnlToBeRealized(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct IExchange.RealizePnlParams params</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (int256 pnlToBeRealized)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get the pnl that can be realized if trader reduce position</p><p>This function normally won&#x27;t be needed by traders, but it might be useful for 3rd party</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters-3"></a>Parameters:<a class="hash-link" href="#parameters-3" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>params</code></td><td align="left">struct IExchange.RealizePnlParams</td><td align="left">The params needed to do the query, encoded as <code>RealizePnlParams</code> in calldata</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-6"></a>Return Values:<a class="hash-link" href="#return-values-6" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>pnlToBeRealized</code></td><td align="left">int256</td><td align="left">The pnl that can be realized if trader reduce position</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getorderbook"></a>getOrderBook<a class="hash-link" href="#getorderbook" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getOrderBook(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (address orderBook)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get <code>OrderBook</code> contract address</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-7"></a>Return Values:<a class="hash-link" href="#return-values-7" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>orderBook</code></td><td align="left">address</td><td align="left"><code>OrderBook</code> contract address</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getaccountbalance"></a>getAccountBalance<a class="hash-link" href="#getaccountbalance" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getAccountBalance(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (address accountBalance)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get <code>AccountBalance</code> contract address</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-8"></a>Return Values:<a class="hash-link" href="#return-values-8" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>accountBalance</code></td><td align="left">address</td><td align="left"><code>AccountBalance</code> contract address</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="getclearinghouseconfig"></a>getClearingHouseConfig<a class="hash-link" href="#getclearinghouseconfig" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  function getClearingHouseConfig(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) external returns (address clearingHouse)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Get <code>ClearingHouseConfig</code> contract address</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="return-values-9"></a>Return Values:<a class="hash-link" href="#return-values-9" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>clearingHouse</code></td><td align="left">address</td><td align="left"><code>ClearingHouseConfig</code> contract address</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="events"></a>Events<a class="hash-link" href="#events" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="fundingupdated"></a>FundingUpdated<a class="hash-link" href="#fundingupdated" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  event FundingUpdated(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 markTwap,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 indexTwap</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Emitted when the global funding growth is updated</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters-4"></a>Parameters:<a class="hash-link" href="#parameters-4" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>baseToken</code></td><td align="left">address</td><td align="left">Address of the base token</td></tr><tr><td align="left"><code>markTwap</code></td><td align="left">uint256</td><td align="left">The market twap price when the funding growth is updated</td></tr><tr><td align="left"><code>indexTwap</code></td><td align="left">uint256</td><td align="left">The index twap price when the funding growth is updated</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="maxtickcrossedwithinblockchanged"></a>MaxTickCrossedWithinBlockChanged<a class="hash-link" href="#maxtickcrossedwithinblockchanged" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  event MaxTickCrossedWithinBlockChanged(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address baseToken,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint24 maxTickCrossedWithinBlock</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Emitted when maxTickCrossedWithinBlock is updated</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters-5"></a>Parameters:<a class="hash-link" href="#parameters-5" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>baseToken</code></td><td align="left">address</td><td align="left">Address of the base token</td></tr><tr><td align="left"><code>maxTickCrossedWithinBlock</code></td><td align="left">uint24</td><td align="left">Max tick allowed to be crossed within block when reducing position</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="accountbalancechanged"></a>AccountBalanceChanged<a class="hash-link" href="#accountbalancechanged" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI solidity"><pre tabindex="0" class="prism-code language-solidity codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">  event AccountBalanceChanged(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    address accountBalance</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Emitted when accountBalance is updated</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="parameters-6"></a>Parameters:<a class="hash-link" href="#parameters-6" title="Direct link to heading">#</a></h4><table><thead><tr><th align="left">Name</th><th align="left">Type</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>accountBalance</code></td><td align="left">address</td><td align="left">The address of accountBalance contract</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/perpetual-protocol/lushan-docs/tree/main/docs/Interfaces/IExchange.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/lushan-docs/docs/Interfaces/IERC20Metadata"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« IERC20Metadata</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/lushan-docs/docs/Interfaces/IIndexPrice"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">IIndexPrice Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#swapparams" class="table-of-contents__link">SwapParams</a></li><li><a href="#swapresponse" class="table-of-contents__link">SwapResponse</a></li><li><a href="#swapcallbackdata" class="table-of-contents__link">SwapCallbackData</a></li><li><a href="#realizepnlparams" class="table-of-contents__link">RealizePnlParams</a></li><li><a href="#functions" class="table-of-contents__link">Functions</a><ul><li><a href="#swap" class="table-of-contents__link">swap</a></li><li><a href="#settlefunding" class="table-of-contents__link">settleFunding</a></li><li><a href="#getmaxtickcrossedwithinblock" class="table-of-contents__link">getMaxTickCrossedWithinBlock</a></li><li><a href="#getallpendingfundingpayment" class="table-of-contents__link">getAllPendingFundingPayment</a></li><li><a href="#getpendingfundingpayment" class="table-of-contents__link">getPendingFundingPayment</a></li><li><a href="#getsqrtmarktwapx96" class="table-of-contents__link">getSqrtMarkTwapX96</a></li><li><a href="#getpnltoberealized" class="table-of-contents__link">getPnlToBeRealized</a></li><li><a href="#getorderbook" class="table-of-contents__link">getOrderBook</a></li><li><a href="#getaccountbalance" class="table-of-contents__link">getAccountBalance</a></li><li><a href="#getclearinghouseconfig" class="table-of-contents__link">getClearingHouseConfig</a></li></ul></li><li><a href="#events" class="table-of-contents__link">Events</a><ul><li><a href="#fundingupdated" class="table-of-contents__link">FundingUpdated</a></li><li><a href="#maxtickcrossedwithinblockchanged" class="table-of-contents__link">MaxTickCrossedWithinBlockChanged</a></li><li><a href="#accountbalancechanged" class="table-of-contents__link">AccountBalanceChanged</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/lushan-docs/docs/ContractOverview">Contract</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.com/invite/SxK4Zw9NgQ" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/perpprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/perpetual-protocol/lushan-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Perpetual protocol docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/lushan-docs/assets/js/runtime~main.8cd79a0c.js"></script>
<script src="/lushan-docs/assets/js/main.9411a86b.js"></script>
</body>
</html>