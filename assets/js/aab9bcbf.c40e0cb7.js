"use strict";(self.webpackChunklushan_docs=self.webpackChunklushan_docs||[]).push([[46],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return g}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),s=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=s(n),g=r,m=p["".concat(o,".").concat(g)]||p[g]||u[g]||i;return n?a.createElement(m,l(l({ref:t},c),{},{components:n})):a.createElement(m,l({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=p;var d={};for(var o in t)hasOwnProperty.call(t,o)&&(d[o]=t[o]);d.originalType=e,d.mdxType="string"==typeof e?e:r,l[1]=d;for(var s=2;s<i;s++)l[s]=n[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3052:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return d},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return c},default:function(){return p}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],d={},o=void 0,s={unversionedId:"Interfaces/IExchange",id:"Interfaces/IExchange",isDocsHomePage:!1,title:"IExchange",description:"Structs",source:"@site/docs/Interfaces/IExchange.md",sourceDirName:"Interfaces",slug:"/Interfaces/IExchange",permalink:"/lushan-docs/docs/Interfaces/IExchange",editUrl:"https://github.com/perpetual-protocol/lushan-docs/tree/main/docs/Interfaces/IExchange.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"IERC20Metadata",permalink:"/lushan-docs/docs/Interfaces/IERC20Metadata"},next:{title:"IIndexPrice",permalink:"/lushan-docs/docs/Interfaces/IIndexPrice"}},c=[{value:"Structs",id:"structs",children:[{value:"SwapParams",id:"swapparams",children:[]},{value:"SwapResponse",id:"swapresponse",children:[]},{value:"SwapCallbackData",id:"swapcallbackdata",children:[]},{value:"RealizePnlParams",id:"realizepnlparams",children:[]}]},{value:"Functions",id:"functions",children:[{value:"swap",id:"swap",children:[]},{value:"settleFunding",id:"settlefunding",children:[]},{value:"getMaxTickCrossedWithinBlock",id:"getmaxtickcrossedwithinblock",children:[]},{value:"getAllPendingFundingPayment",id:"getallpendingfundingpayment",children:[]},{value:"getPendingFundingPayment",id:"getpendingfundingpayment",children:[]},{value:"getSqrtMarkTwapX96",id:"getsqrtmarktwapx96",children:[]},{value:"getPnlToBeRealized",id:"getpnltoberealized",children:[]},{value:"getOrderBook",id:"getorderbook",children:[]},{value:"getAccountBalance",id:"getaccountbalance",children:[]},{value:"getClearingHouseConfig",id:"getclearinghouseconfig",children:[]}]},{value:"Events",id:"events",children:[{value:"FundingUpdated",id:"fundingupdated",children:[]},{value:"MaxTickCrossedWithinBlockChanged",id:"maxtickcrossedwithinblockchanged",children:[]},{value:"AccountBalanceChanged",id:"accountbalancechanged",children:[]}]}],u={toc:c};function p(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"structs"},"Structs"),(0,i.kt)("h3",{id:"swapparams"},"SwapParams"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  struct SwapParams(\n    address trader\n    address baseToken\n    bool isBaseToQuote\n    bool isExactInput\n    bool isClose\n    uint256 amount\n    uint160 sqrtPriceLimitX96\n  )\n")),(0,i.kt)("h3",{id:"swapresponse"},"SwapResponse"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  struct SwapResponse(\n    uint256 base\n    uint256 quote\n    int256 exchangedPositionSize\n    int256 exchangedPositionNotional\n    uint256 fee\n    uint256 insuranceFundFee\n    int256 pnlToBeRealized\n    uint256 sqrtPriceAfterX96\n    int24 tick\n    bool isPartialClose\n  )\n")),(0,i.kt)("h3",{id:"swapcallbackdata"},"SwapCallbackData"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  struct SwapCallbackData(\n    address trader\n    address baseToken\n    address pool\n    uint24 uniswapFeeRatio\n    uint256 fee\n  )\n")),(0,i.kt)("h3",{id:"realizepnlparams"},"RealizePnlParams"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  struct RealizePnlParams(\n    address trader\n    address baseToken\n    int256 base\n    int256 quote\n  )\n")),(0,i.kt)("h2",{id:"functions"},"Functions"),(0,i.kt)("h3",{id:"swap"},"swap"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function swap(\n  ) external returns (struct IExchange.SwapResponse)\n")),(0,i.kt)("h3",{id:"settlefunding"},"settleFunding"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function settleFunding(\n  ) external returns (int256 fundingPayment, struct Funding.Growth fundingGrowthGlobal)\n")),(0,i.kt)("p",null,"this function should be called at the beginning of every high-level function, such as openPosition()\nwhile it doesn't matter who calls this function\nthis function 1. settles personal funding payment 2. updates global funding growth\npersonal funding payment is settled whenever there is pending funding payment\nthe global funding growth update only happens once per unique timestamp (not blockNumber, due to Arbitrum)"),(0,i.kt)("h4",{id:"return-values"},"Return Values:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"fundingPayment")),(0,i.kt)("td",{parentName:"tr",align:"left"},"address"),(0,i.kt)("td",{parentName:"tr",align:"left"},"the funding payment of a trader in one market should be settled into owned realized Pnl")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"fundingGrowthGlobal")),(0,i.kt)("td",{parentName:"tr",align:"left"},"address"),(0,i.kt)("td",{parentName:"tr",align:"left"},"the up-to-date globalFundingGrowth, usually used for later calculations")))),(0,i.kt)("h3",{id:"getmaxtickcrossedwithinblock"},"getMaxTickCrossedWithinBlock"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getMaxTickCrossedWithinBlock(\n  ) external returns (uint24)\n")),(0,i.kt)("h3",{id:"getallpendingfundingpayment"},"getAllPendingFundingPayment"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getAllPendingFundingPayment(\n  ) external returns (int256)\n")),(0,i.kt)("h3",{id:"getpendingfundingpayment"},"getPendingFundingPayment"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getPendingFundingPayment(\n  ) external returns (int256)\n")),(0,i.kt)("p",null,"this is the view version of _updateFundingGrowth()"),(0,i.kt)("h4",{id:"return-values-1"},"Return Values:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"the")),(0,i.kt)("td",{parentName:"tr",align:"left"},"address"),(0,i.kt)("td",{parentName:"tr",align:"left"},"pending funding payment of a trader in one market, including liquidity & balance coefficients")))),(0,i.kt)("h3",{id:"getsqrtmarktwapx96"},"getSqrtMarkTwapX96"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getSqrtMarkTwapX96(\n  ) external returns (uint160)\n")),(0,i.kt)("h3",{id:"getpnltoberealized"},"getPnlToBeRealized"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getPnlToBeRealized(\n  ) external returns (int256)\n")),(0,i.kt)("h3",{id:"getorderbook"},"getOrderBook"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getOrderBook(\n  ) external returns (address)\n")),(0,i.kt)("h3",{id:"getaccountbalance"},"getAccountBalance"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getAccountBalance(\n  ) external returns (address)\n")),(0,i.kt)("h3",{id:"getclearinghouseconfig"},"getClearingHouseConfig"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  function getClearingHouseConfig(\n  ) external returns (address)\n")),(0,i.kt)("h2",{id:"events"},"Events"),(0,i.kt)("h3",{id:"fundingupdated"},"FundingUpdated"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  event FundingUpdated(\n  )\n")),(0,i.kt)("h3",{id:"maxtickcrossedwithinblockchanged"},"MaxTickCrossedWithinBlockChanged"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  event MaxTickCrossedWithinBlockChanged(\n  )\n")),(0,i.kt)("h3",{id:"accountbalancechanged"},"AccountBalanceChanged"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"  event AccountBalanceChanged(\n    address accountBalance\n  )\n")),(0,i.kt)("h4",{id:"parameters"},"Parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"left"},"Name"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Type"),(0,i.kt)("th",{parentName:"tr",align:"left"},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"left"},(0,i.kt)("inlineCode",{parentName:"td"},"accountBalance")),(0,i.kt)("td",{parentName:"tr",align:"left"},"address"),(0,i.kt)("td",{parentName:"tr",align:"left"},"The address of accountBalance contract")))))}p.isMDXComponent=!0}}]);