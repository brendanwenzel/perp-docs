"use strict";(self.webpackChunkperp_docs=self.webpackChunkperp_docs||[]).push([[270],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>d});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},p=Object.keys(e);for(r=0;r<p.length;r++)a=p[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(r=0;r<p.length;r++)a=p[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),o=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=o(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,p=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=o(a),d=n,h=m["".concat(s,".").concat(d)]||m[d]||u[d]||p;return a?r.createElement(h,l(l({ref:t},c),{},{components:a})):r.createElement(h,l({ref:t},c))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var p=a.length,l=new Array(p);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var o=2;o<p;o++)l[o]=a[o];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},6485:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>p,metadata:()=>i,toc:()=>o});var r=a(7462),n=(a(7294),a(3905));const p={id:"data-source",title:"Data Source"},l="Data Source",i={unversionedId:"guides/data-source",id:"guides/data-source",title:"Data Source",description:"Smart Contracts",source:"@site/docs/guides/DataSource.md",sourceDirName:"guides",slug:"/guides/data-source",permalink:"/perp-docs/docs/guides/data-source",draft:!1,editUrl:"https://github.com/perpetual-protocol/perp-docs/tree/main/docs/guides/DataSource.md",tags:[],version:"current",frontMatter:{id:"data-source",title:"Data Source"},sidebar:"tutorialSidebar",previous:{title:"VirtualToken",permalink:"/perp-docs/docs/contracts/VirtualToken"},next:{title:"Query Trader Info",permalink:"/perp-docs/docs/guides/how-to-get-trader-info"}},s={},o=[{value:"Smart Contracts",id:"smart-contracts",level:2},{value:"Exploring Data",id:"exploring-data",level:3},{value:"Usage Examples",id:"usage-examples",level:3},{value:"The Graph",id:"the-graph",level:2},{value:"Exploring Data",id:"exploring-data-1",level:3},{value:"Usage Examples",id:"usage-examples-1",level:3},{value:"AppSync",id:"appsync",level:2},{value:"Exploring Data",id:"exploring-data-2",level:3},{value:"Usage Examples",id:"usage-examples-2",level:3},{value:"Examples of Mixed Data Sources",id:"examples-of-mixed-data-sources",level:2}],c={toc:o};function u(e){let{components:t,...p}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,p,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"data-source"},"Data Source"),(0,n.kt)("h2",{id:"smart-contracts"},"Smart Contracts"),(0,n.kt)("p",null,"We see smart contracts as the default data source. For anything that is retrievable via smart contracts directly, we mostly will get them by reading the contracts."),(0,n.kt)("h3",{id:"exploring-data"},"Exploring Data"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Please find the contract addresses in the metadata")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Optimistic: ",(0,n.kt)("a",{parentName:"li",href:"https://metadata.perp.exchange/v2/optimism.json"},"https://metadata.perp.exchange/v2/optimism.json")),(0,n.kt)("li",{parentName:"ul"},"Optimistic Kovan: ",(0,n.kt)("a",{parentName:"li",href:"https://metadata.perp.exchange/v2/optimism-kovan.json"},"https://metadata.perp.exchange/v2/optimism-kovan.json"))),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"You can then search the address with the blockchain explorer to see the read/write interface of the contracts")),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Optimistic: ",(0,n.kt)("a",{parentName:"li",href:"https://optimistic.etherscan.io/"},"https://optimistic.etherscan.io/")),(0,n.kt)("li",{parentName:"ul"},"Optimistic Kovan: ",(0,n.kt)("a",{parentName:"li",href:"https://kovan-optimistic.etherscan.io/"},"https://kovan-optimistic.etherscan.io/"))),(0,n.kt)("h3",{id:"usage-examples"},"Usage Examples"),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"Please check out ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/perpetual-protocol/sdk-curie"},"https://github.com/perpetual-protocol/sdk-curie"),", a Javascript SDK to interface with our v2 smart contracts.")),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"the-graph"},"The Graph"),(0,n.kt)("p",null,"We use ",(0,n.kt)("a",{parentName:"p",href:"https://thegraph.com/"},"The Graph")," as the default on-chain data indexing service. For any data that cannot be retrieved from smart contracts directly, for example some aggregated data, we mostly will fetch from The Graph."),(0,n.kt)("h3",{id:"exploring-data-1"},"Exploring Data"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Use either of the provided servers:",(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-json"},'"graphServerConfigs": [\n    {\n        "url": "https://api.thegraph.com/subgraphs/name/perpetual-protocol/perpetual-v2-optimism",\n        "wsUrl": "wss://api.thegraph.com/subgraphs/name/perpetual-protocol/perpetual-v2-optimism",\n        "healthUrl": "https://api.thegraph.com/index-node/graphql",\n        "name": "perpetual-protocol/perpetual-v2-optimism"\n    },\n    {\n        "url": "https://subgraph-api-singapore.perp.fi/subgraphs/name/perpetual-protocol/perpetual-v2-optimism",\n        "wsUrl": "wss://subgraph-ws-singapore.perp.fi/subgraphs/name/perpetual-protocol/perpetual-v2-optimism",\n        "healthUrl": "https://subgraph-singapore.perp.fi:8030/graphql",\n        "name": "perpetual-protocol/perpetual-v2-optimism"\n    }\n]\n'))),(0,n.kt)("li",{parentName:"ul"},"You will see a GraphQL explorer interface by opening the URL.","  ",(0,n.kt)("img",{src:a(6469).Z,width:"1918",height:"989"}))),(0,n.kt)("h3",{id:"usage-examples-1"},"Usage Examples"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Market Detail / Funding Rate (8h)\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(7224).Z,width:"676",height:"70"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Market Detail / Trades\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(9609).Z,width:"370",height:"315"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Market Detail / Fills\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(9232).Z,width:"757",height:"286"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"History (all tabs)\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(3371).Z,width:"1371",height:"658"})),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"appsync"},"AppSync"),(0,n.kt)("p",null,"We use ",(0,n.kt)("a",{parentName:"p",href:"https://aws.amazon.com/appsync/"},"AppSync")," as an alternative to The Graph for time sensitive data, e.g. price chart series, since The Graph can sometimes be out of sync or unstable. We use as little data from AppSync as possible since AppSync is centralized."),(0,n.kt)("h3",{id:"exploring-data-2"},"Exploring Data"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Please use the keys provided below to connect",(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-json"},'"candleServerConfigs": [\n    {\n        "url": "https://4b3vdz2hdjho7gzuo4wl2jgsoe.appsync-api.ap-southeast-1.amazonaws.com/graphql",\n        "region": "ap-southeast-1",\n        "key": "xxxxxxxxxx"\n    }\n],\n"statisticsServerConfigs": [\n    {\n        "url": "https://4b3vdz2hdjho7gzuo4wl2jgsoe.appsync-api.ap-southeast-1.amazonaws.com/graphql",\n        "region": "ap-southeast-1",\n        "key": "xxxxxxxxxx"\n    }\n]\n')))),(0,n.kt)("h3",{id:"usage-examples-2"},"Usage Examples"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Candle Price Chart"),(0,n.kt)("li",{parentName:"ul"},"Market Statistics",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"funding rate"),(0,n.kt)("li",{parentName:"ul"},"volume24h"),(0,n.kt)("li",{parentName:"ul"},"Change (24h)"))),(0,n.kt)("li",{parentName:"ul"},"Reward",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"Gas Rebate"),(0,n.kt)("li",{parentName:"ul"},"Liquidity Mining")))),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(6854).Z,width:"305",height:"442"})),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Pool APR\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(571).Z,width:"363",height:"214"})),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(492).Z,width:"547",height:"148"})),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"examples-of-mixed-data-sources"},"Examples of Mixed Data Sources"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"TVL",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"pool")," from ",(0,n.kt)("strong",{parentName:"p"},"The Graph"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"markPrice")," from ",(0,n.kt)("strong",{parentName:"p"},"smart contracts")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"pool.baseAmount.mul(markPrice).add(pool.quoteAmount)\n"))))),(0,n.kt)("li",{parentName:"ul"},"24h Fees",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"volume24h")," from A",(0,n.kt)("strong",{parentName:"p"},"ppSync"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"exchangeFeeRatios")," from ",(0,n.kt)("strong",{parentName:"p"},"smart contracts"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("inlineCode",{parentName:"p"},"pool")," from ",(0,n.kt)("strong",{parentName:"p"},"The Graph")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"volume24h.mul(exchangeFeeRatios[pool.baseAddress])\n"))))),(0,n.kt)("li",{parentName:"ul"},"Liquidity Pool\n")),(0,n.kt)("p",null,(0,n.kt)("img",{src:a(8595).Z,width:"1007",height:"827"})))}u.isMDXComponent=!0},7224:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/funding_rate-641aaab4785222348e4886b4aac0cda3.png"},6469:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/graphiql_screenshot-54b2c6b518fc9cbf675d0635e45b2f93.png"},3371:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/history-0d3870f16acdf600331dafac943e15ba.png"},8595:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/liquidity_pool-b41ff4a2b3022307df190305bf059775.jpeg"},9232:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/market_filled-80adade0ade4559a28ab117d8afcb330.png"},9609:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/market_trades-5c468cf2eb975e366492cc4767ed2471.png"},571:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/pool_apr-dca620ff413337fb487d70b180885e22.png"},492:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/pool_net_return-a74fefee92ef6d3d69a9d33852b99e42.png"},6854:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/reward-a26c42b4efbc82a405a09ff66c9036b3.png"}}]);